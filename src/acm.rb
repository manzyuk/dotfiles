#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

# Usage: ruby acm.rb name1 name2 ...
#
# Retrieve BibTeX items for all publications of authors matching
# name1, name2, ... from the ACM digital library.

require 'open-uri'
require 'timeout'

PRE = /<pre.*?>(.*?)<\/pre>/im
DEC = /\\&\\#[0-9]{2,3};/
HEX = /\\&\\#x[0-9A-Fa-f]{4};/

# Lookup tables for conversion of HTML entities to TeX.
DEC2TEX = {
  '\&\#32;'  => ' ',
  '\&\#33;'  => '!',
  '\&\#34;'  => '"',
  '\&\#35;'  => '\\#',
  '\&\#36;'  => '\\$',
  '\&\#37;'  => '\\%',
  '\&\#38;'  => '\\&',
  '\&\#39;'  => '\'',
  '\&\#40;'  => '(',
  '\&\#41;'  => ')',
  '\&\#42;'  => '*',
  '\&\#43;'  => '+',
  '\&\#44;'  => ',',
  '\&\#45;'  => '-',
  '\&\#46;'  => '.',
  '\&\#47;'  => '/',
  '\&\#48;'  => '0',
  '\&\#49;'  => '1',
  '\&\#50;'  => '2',
  '\&\#51;'  => '3',
  '\&\#52;'  => '4',
  '\&\#53;'  => '5',
  '\&\#54;'  => '6',
  '\&\#55;'  => '7',
  '\&\#56;'  => '8',
  '\&\#57;'  => '9',
  '\&\#58;'  => ':',
  '\&\#59;'  => ';',
  '\&\#60;'  => '<',
  '\&\#61;'  => '=',
  '\&\#62;'  => '>',
  '\&\#63;'  => '?',
  '\&\#64;'  => '@',
  '\&\#65;'  => 'A',
  '\&\#66;'  => 'B',
  '\&\#67;'  => 'C',
  '\&\#68;'  => 'D',
  '\&\#69;'  => 'E',
  '\&\#70;'  => 'F',
  '\&\#71;'  => 'G',
  '\&\#72;'  => 'H',
  '\&\#73;'  => 'I',
  '\&\#74;'  => 'J',
  '\&\#75;'  => 'K',
  '\&\#76;'  => 'L',
  '\&\#77;'  => 'M',
  '\&\#78;'  => 'N',
  '\&\#79;'  => 'O',
  '\&\#80;'  => 'P',
  '\&\#81;'  => 'Q',
  '\&\#82;'  => 'R',
  '\&\#83;'  => 'S',
  '\&\#84;'  => 'T',
  '\&\#85;'  => 'U',
  '\&\#86;'  => 'V',
  '\&\#87;'  => 'W',
  '\&\#88;'  => 'X',
  '\&\#89;'  => 'Y',
  '\&\#90;'  => 'Z',
  '\&\#91;'  => '[',
  '\&\#92;'  => '{\\textbackslash}',
  '\&\#93;'  => ']',
  '\&\#94;'  => '{\\textasciicircum}',
  '\&\#95;'  => '\\_',
  '\&\#96;'  => '{\\textquoteleft}',
  '\&\#97;'  => 'a',
  '\&\#98;'  => 'b',
  '\&\#99;'  => 'c',
  '\&\#100;' => 'd',
  '\&\#101;' => 'e',
  '\&\#102;' => 'f',
  '\&\#103;' => 'g',
  '\&\#104;' => 'h',
  '\&\#105;' => 'i',
  '\&\#106;' => 'j',
  '\&\#107;' => 'k',
  '\&\#108;' => 'l',
  '\&\#109;' => 'm',
  '\&\#110;' => 'n',
  '\&\#111;' => 'o',
  '\&\#112;' => 'p',
  '\&\#113;' => 'q',
  '\&\#114;' => 'r',
  '\&\#115;' => 's',
  '\&\#116;' => 't',
  '\&\#117;' => 'u',
  '\&\#118;' => 'v',
  '\&\#119;' => 'w',
  '\&\#120;' => 'x',
  '\&\#121;' => 'y',
  '\&\#122;' => 'z',
  '\&\#123;' => '\\{',
  '\&\#124;' => '{\\textbar}',
  '\&\#125;' => '\\}',
  '\&\#126;' => '{\\textasciitilde}',

  '\&\#192;' => '\\`{A}',
  '\&\#193;' => '\\\'{A}',
  '\&\#194;' => '\\^{A}',
  '\&\#195;' => '\\~{A}',
  '\&\#196;' => '\\"{A}',
  '\&\#197;' => '\\r{A}',
  '\&\#198;' => '\\AE',
  '\&\#199;' => '\\c{C}',
  '\&\#200;' => '\\`{E}',
  '\&\#201;' => '\\\'{E}',
  '\&\#202;' => '\\^{E}',
  '\&\#203;' => '\\"{E}',
  '\&\#204;' => '\\`{I}',
  '\&\#205;' => '\\\'{I}',
  '\&\#206;' => '\\^{I}',
  '\&\#207;' => '\\"{I}',
  '\&\#208;' => '{\\DJ}',
  '\&\#209;' => '\\~{N}',
  '\&\#210;' => '\\`{O}',
  '\&\#211;' => '\\\'{O}',
  '\&\#212;' => '\\^{O}',
  '\&\#213;' => '\\~{O}',
  '\&\#214;' => '\\"{O}',
  '\&\#215;' => '$\\times$',
  '\&\#216;' => '\\O',
  '\&\#217;' => '\\`{U}',
  '\&\#218;' => '\\\'{U}',
  '\&\#219;' => '\\^{U}',
  '\&\#220;' => '\\"{U}',
  '\&\#221;' => '\\\'{Y}',
  '\&\#222;' => '{\\TH}',
  '\&\#223;' => '{\\ss}',
  '\&\#224;' => '\\`{a}',
  '\&\#225;' => '\\\'{a}',
  '\&\#226;' => '\\^{a}',
  '\&\#227;' => '\\~{a}',
  '\&\#228;' => '\\"{a}',
  '\&\#229;' => '\\r{a}',
  '\&\#230;' => '{\\ae}',
  '\&\#231;' => '\\c{c}',
  '\&\#232;' => '\\`{e}',
  '\&\#233;' => '\\\'{e}',
  '\&\#234;' => '\\^{e}',
  '\&\#235;' => '\\"{e}',
  '\&\#236;' => '\\`{i}',
  '\&\#237;' => '\\\'{i}',
  '\&\#238;' => '\\^{i}',
  '\&\#239;' => '\\"{i}',
  '\&\#240;' => '{\\dh}',
  '\&\#241;' => '\\~{n}',
  '\&\#242;' => '\\`{o}',
  '\&\#243;' => '\\\'{o}',
  '\&\#244;' => '\\^{o}',
  '\&\#245;' => '\\~{o}',
  '\&\#246;' => '\\"{o}',
  '\&\#247;' => '\\div',
  '\&\#248;' => '\\o',
  '\&\#249;' => '\\`{u}',
  '\&\#250;' => '\\\'{u}',
  '\&\#251;' => '\\^{u}',
  '\&\#252;' => '\\"{u}',
  '\&\#253;' => '\\\'{y}',
  '\&\#254;' => '{\\th}',
  '\&\#255;' => '\\"{y}',
  '\&\#256;' => '\\={A}',
  '\&\#257;' => '\\={a}',
  '\&\#258;' => '\\u{A}',
  '\&\#259;' => '\\u{a}',
  '\&\#260;' => '\\k{A}',
  '\&\#261;' => '\\k{a}',
  '\&\#262;' => '\\\'{C}',
  '\&\#263;' => '\\\'{c}',
  '\&\#264;' => '\\^{C}',
  '\&\#265;' => '\\^{c}',
  '\&\#266;' => '\\.{C}',
  '\&\#267;' => '\\.{c}',
  '\&\#268;' => '\\v{C}',
  '\&\#269;' => '\\v{c}',
  '\&\#270;' => '\\v{D}',
  '\&\#271;' => 'd\'',
  '\&\#272;' => '{\\DJ}',
  '\&\#273;' => '{\\dj}',
  '\&\#274;' => '\\={E}',
  '\&\#275;' => '\\={e}',
  '\&\#276;' => '\\u{E}',
  '\&\#277;' => '\\u{e}',
  '\&\#278;' => '\\.{E}',
  '\&\#279;' => '\\.{e}',
  '\&\#280;' => '\\k{E}',
  '\&\#281;' => '\\k{e}',
  '\&\#282;' => '\\v{E}',
  '\&\#283;' => '\\v{e}',
  '\&\#284;' => '\\^{G}',
  '\&\#285;' => '\\^{g}',
  '\&\#286;' => '\\u{G}',
  '\&\#287;' => '\\u{g}',
  '\&\#288;' => '\\.{G}',
  '\&\#289;' => '\\.{g}',
  '\&\#290;' => 'G',
  '\&\#291;' => '\\\'{g}',
  '\&\#292;' => '\\^{H}',
  '\&\#293;' => '\\^{h}',
  '\&\#294;' => 'H',
  '\&\#295;' => 'h',
  '\&\#296;' => '\\~{I}',
  '\&\#297;' => '\\~{i}',
  '\&\#298;' => '\\={I}',
  '\&\#299;' => '\\={i}',
  '\&\#300;' => '\\u{I}',
  '\&\#301;' => '\\u{i}',
  '\&\#302;' => '\\c{I}',
  '\&\#303;' => '\\c{i}',
  '\&\#304;' => '\\.{I}',
  '\&\#305;' => '{\\i}',
  '\&\#306;' => 'IJ',
  '\&\#307;' => 'ij',
  '\&\#308;' => '\\^{J}',
  '\&\#309;' => '\\^{j}',
  '\&\#310;' => 'K',
  '\&\#311;' => 'k',
  '\&\#312;' => 'k',
  '\&\#313;' => '\\\'{L}',
  '\&\#314;' => '\\\'{l}',
  '\&\#315;' => 'L',
  '\&\#316;' => 'l',
  '\&\#317;' => 'L\'',
  '\&\#318;' => 'l\'',
  '\&\#319;' => 'L',
  '\&\#320;' => 'l',
  '\&\#321;' => '{\\L}',
  '\&\#322;' => '{\\l}',
  '\&\#323;' => '\\\'{N}',
  '\&\#324;' => '\\\'{n}',
  '\&\#325;' => 'N',
  '\&\#326;' => 'n',
  '\&\#327;' => '\\v{N}',
  '\&\#328;' => '\\v{n}',
  '\&\#329;' => 'n',
  '\&\#330;' => '{\\NG}',
  '\&\#331;' => '{\\ng}',
  '\&\#332;' => '\\={O}',
  '\&\#333;' => '\\={o}',
  '\&\#334;' => '\\u{O}',
  '\&\#335;' => '\\u{o}',
  '\&\#336;' => '\\H{A}',
  '\&\#337;' => '\\H{a}',
  '\&\#338;' => '{\\OE}',
  '\&\#339;' => '{\\oe}',
  '\&\#340;' => '\\\'{R}',
  '\&\#341;' => '\\\'{r}',
  '\&\#342;' => 'R',
  '\&\#343;' => 'r',
  '\&\#344;' => '\\v{R}',
  '\&\#345;' => '\\v{r}',
  '\&\#346;' => '\\\'{S}',
  '\&\#347;' => '\\\'{S}',
  '\&\#348;' => '\\^{S}',
  '\&\#349;' => '\\^{s}',
  '\&\#350;' => '\\c{S}',
  '\&\#351;' => '\\c{s}',
  '\&\#352;' => '\\v{S}',
  '\&\#353;' => '\\v{s}',
  '\&\#354;' => 'T',
  '\&\#355;' => 't',
  '\&\#356;' => '\\v{T}',
  '\&\#357;' => 't\'',
  '\&\#358;' => 'T',
  '\&\#359;' => 't',
  '\&\#360;' => '\\~{U}',
  '\&\#361;' => '\\~{u}',
  '\&\#362;' => '\\={U}',
  '\&\#363;' => '\\={u}',
  '\&\#364;' => '\\u{U}',
  '\&\#365;' => '\\u{u}',
  '\&\#366;' => '\\r{U}',
  '\&\#367;' => '\\r{u}',
  '\&\#368;' => '\\H{U}',
  '\&\#369;' => '\\H{u}',
  '\&\#370;' => '\\k{U}',
  '\&\#371;' => '\\k{u}',
  '\&\#372;' => '\\^{W}',
  '\&\#373;' => '\\^{w}',
  '\&\#374;' => '\\^{Y}',
  '\&\#375;' => '\\^{y}',
  '\&\#376;' => '\\"{Y}',
  '\&\#377;' => '\\\'{Z}',
  '\&\#378;' => '\\\'{z}',
  '\&\#379;' => '\\.{Z}',
  '\&\#380;' => '\\.{z}',
  '\&\#381;' => '\\v{Z}',
  '\&\#382;' => '\\v{z}',
  '\&\#383;' => "f"
}

HEX2TEX = {
  '\&\#x0020;' => ' ',
  '\&\#x0021;' => '!',
  '\&\#x0022;' => '"',
  '\&\#x0023;' => '\\#',
  '\&\#x0024;' => '\\$',
  '\&\#x0025;' => '\\%',
  '\&\#x0026;' => '\\&',
  '\&\#x0027;' => '\'',
  '\&\#x0028;' => '(',
  '\&\#x0029;' => ')',
  '\&\#x002a;' => '*',
  '\&\#x002b;' => '+',
  '\&\#x002c;' => ',',
  '\&\#x002d;' => '-',
  '\&\#x002e;' => '.',
  '\&\#x002f;' => '/',
  '\&\#x0030;' => '0',
  '\&\#x0031;' => '1',
  '\&\#x0032;' => '2',
  '\&\#x0033;' => '3',
  '\&\#x0034;' => '4',
  '\&\#x0035;' => '5',
  '\&\#x0036;' => '6',
  '\&\#x0037;' => '7',
  '\&\#x0038;' => '8',
  '\&\#x0039;' => '9',
  '\&\#x003a;' => ':',
  '\&\#x003b;' => ';',
  '\&\#x003c;' => '<',
  '\&\#x003d;' => '=',
  '\&\#x003e;' => '>',
  '\&\#x003f;' => '?',
  '\&\#x0040;' => '@',
  '\&\#x0041;' => 'A',
  '\&\#x0042;' => 'B',
  '\&\#x0043;' => 'C',
  '\&\#x0044;' => 'D',
  '\&\#x0045;' => 'E',
  '\&\#x0046;' => 'F',
  '\&\#x0047;' => 'G',
  '\&\#x0048;' => 'H',
  '\&\#x0049;' => 'I',
  '\&\#x004a;' => 'J',
  '\&\#x004b;' => 'K',
  '\&\#x004c;' => 'L',
  '\&\#x004d;' => 'M',
  '\&\#x004e;' => 'N',
  '\&\#x004f;' => 'O',
  '\&\#x0050;' => 'P',
  '\&\#x0051;' => 'Q',
  '\&\#x0052;' => 'R',
  '\&\#x0053;' => 'S',
  '\&\#x0054;' => 'T',
  '\&\#x0055;' => 'U',
  '\&\#x0056;' => 'V',
  '\&\#x0057;' => 'W',
  '\&\#x0058;' => 'X',
  '\&\#x0059;' => 'Y',
  '\&\#x005a;' => 'Z',
  '\&\#x005b;' => '[',
  '\&\#x005c;' => '{\\textbackslash}',
  '\&\#x005d;' => ']',
  '\&\#x005e;' => '{\\textasciicircum}',
  '\&\#x005f;' => '\\_',
  '\&\#x0060;' => '{\\textquoteleft}',
  '\&\#x0061;' => 'a',
  '\&\#x0062;' => 'b',
  '\&\#x0063;' => 'c',
  '\&\#x0064;' => 'd',
  '\&\#x0065;' => 'e',
  '\&\#x0066;' => 'f',
  '\&\#x0067;' => 'g',
  '\&\#x0068;' => 'h',
  '\&\#x0069;' => 'i',
  '\&\#x006a;' => 'j',
  '\&\#x006b;' => 'k',
  '\&\#x006c;' => 'l',
  '\&\#x006d;' => 'm',
  '\&\#x006e;' => 'n',
  '\&\#x006f;' => 'o',
  '\&\#x0070;' => 'p',
  '\&\#x0071;' => 'q',
  '\&\#x0072;' => 'r',
  '\&\#x0073;' => 's',
  '\&\#x0074;' => 't',
  '\&\#x0075;' => 'u',
  '\&\#x0076;' => 'v',
  '\&\#x0077;' => 'w',
  '\&\#x0078'  => 'x',
  '\&\#x0079'  => 'y',
  '\&\#x007a'  => 'z',
  '\&\#x007b;' => '\\{',
  '\&\#x007c;' => '{\\textbar}',
  '\&\#x007d;' => '\\}',
  '\&\#x007e;' => '{\\textasciitilde}',

  '\&\#x00c0;' => '\\`{A}',
  '\&\#x00c1;' => '\\\'{A}',
  '\&\#x00c2;' => '\\^{A}',
  '\&\#x00c3;' => '\\~{A}',
  '\&\#x00c4;' => '\\"{A}',
  '\&\#x00c5;' => '\\r{A}',
  '\&\#x00c6;' => '\\AE',
  '\&\#x00c7;' => '\\c{C}',
  '\&\#x00c8;' => '\\`{E}',
  '\&\#x00c9;' => '\\\'{E}',
  '\&\#x00ca;' => '\\^{E}',
  '\&\#x00cb;' => '\\"{E}',
  '\&\#x00cc;' => '\\`{I}',
  '\&\#x00cd;' => '\\\'{I}',
  '\&\#x00ce;' => '\\^{I}',
  '\&\#x00cf;' => '\\"{I}',
  '\&\#x00d0;' => '{\\DH}',
  '\&\#x00d1;' => '\\~{N}',
  '\&\#x00d2;' => '\\`{O}',
  '\&\#x00d3;' => '\\\'{O}',
  '\&\#x00d4;' => '\\^{O}',
  '\&\#x00d5;' => '\\~{O}',
  '\&\#x00d6;' => '\\"{O}',
  '\&\#x00d7;' => '$\\times$',
  '\&\#x00d8;' => '\\O',
  '\&\#x00d9;' => '\\`{U}',
  '\&\#x00da;' => '\\\'{U}',
  '\&\#x00db;' => '\\^{U}',
  '\&\#x00dc;' => '\\"{U}',
  '\&\#x00dd;' => '\\\'{Y}',
  '\&\#x00de;' => '{\\TH}',
  '\&\#x00df;' => '{\\ss}',
  '\&\#x00e0;' => '\\`{a}',
  '\&\#x00e1;' => '\\\'{a}',
  '\&\#x00e2;' => '\\^{a}',
  '\&\#x00e3;' => '\\~{a}',
  '\&\#x00e4;' => '\\"{a}',
  '\&\#x00e5;' => '\\r{a}',
  '\&\#x00e6;' => '{\\ae}',
  '\&\#x00e7;' => '\\c{c}',
  '\&\#x00e8;' => '\\`{e}',
  '\&\#x00e9;' => '\\\'{e}',
  '\&\#x00ea;' => '\\^{e}',
  '\&\#x00eb;' => '\\"{e}',
  '\&\#x00ec;' => '\\`{i}',
  '\&\#x00ed;' => '\\\'{i}',
  '\&\#x00ee;' => '\\^{i}',
  '\&\#x00ef;' => '\\"{i}',
  '\&\#x00f0;' => '{\\dh}',
  '\&\#x00f1;' => '\\~{n}',
  '\&\#x00f2;' => '\\`{o}',
  '\&\#x00f3;' => '\\\'{o}',
  '\&\#x00f4;' => '\\^{o}',
  '\&\#x00f5;' => '\\~{o}',
  '\&\#x00f6;' => '\\"{o}',
  '\&\#x00f7;' => '\\div',
  '\&\#x00f8;' => '\\o',
  '\&\#x00f9;' => '\\`{u}',
  '\&\#x00fa;' => '\\\'{u}',
  '\&\#x00fb;' => '\\^{u}',
  '\&\#x00fc;' => '\\"{u}',
  '\&\#x00fd;' => '\\\'{y}',
  '\&\#x00fe;' => '{\\th}',
  '\&\#x00ff;' => '\\"{y}',
  '\&\#x0100;' => '\\={A}',
  '\&\#x0101;' => '\\={a}',
  '\&\#x0102;' => '\\u{A}',
  '\&\#x0103;' => '\\u{a}',
  '\&\#x0104;' => '\\k{A}',
  '\&\#x0105;' => '\\k{a}',
  '\&\#x0106;' => '\\\'{C}',
  '\&\#x0107;' => '\\\'{c}',
  '\&\#x0108;' => '\\^{C}',
  '\&\#x0109;' => '\\^{c}',
  '\&\#x010a;' => '\\.{C}',
  '\&\#x010b;' => '\\.{c}',
  '\&\#x010c;' => '\\v{C}',
  '\&\#x010d;' => '\\v{c}',
  '\&\#x010e;' => '\\v{D}',
  '\&\#x010f;' => 'd\'',        # 'ď' -- ???
  '\&\#x0110;' => '{\\DJ}',
  '\&\#x0111;' => '{\\dj}',
  '\&\#x0112;' => '\\={E}',
  '\&\#x0113;' => '\\={e}',
  '\&\#x0114;' => '\\u{E}',
  '\&\#x0115;' => '\\u{e}',
  '\&\#x0116;' => '\\.{E}',
  '\&\#x0117;' => '\\.{e}',
  '\&\#x0118;' => '\\k{E}',
  '\&\#x0119;' => '\\k{e}',
  '\&\#x011a;' => '\\v{E}',
  '\&\#x011b;' => '\\v{e}',
  '\&\#x011c;' => '\\^{G}',
  '\&\#x011d;' => '\\^{g}',
  '\&\#x011e;' => '\\u{G}',
  '\&\#x011f;' => '\\u{g}',
  '\&\#x0120;' => '\\.{G}',
  '\&\#x0121;' => '\\.{g}',
  '\&\#x0122;' => 'G',          # 'Ģ' -- \cb{G} from 'combelow' package
  '\&\#x0123;' => '\\\'{g}',    # 'ģ' -- \cb{g} from 'combelow' package
  '\&\#x0124;' => '\\^{H}',
  '\&\#x0125;' => '\\^{h}',
  '\&\#x0126;' => 'H',          # 'Ħ' -- ???
  '\&\#x0127;' => 'h',          # 'ħ' -- \textcrh from 't4phonet' package
  '\&\#x0128;' => '\\~{I}',
  '\&\#x0129;' => '\\~{i}',
  '\&\#x012a;' => '\\={I}',
  '\&\#x012b;' => '\\={i}',
  '\&\#x012c;' => '\\u{I}',
  '\&\#x012d;' => '\\u{i}',
  '\&\#x012e;' => '\\c{I}',
  '\&\#x012f;' => '\\c{i}',
  '\&\#x0130;' => '\\.{I}',
  '\&\#x0131;' => '{\\i}',
  '\&\#x0132;' => 'IJ',
  '\&\#x0133;' => 'ij',
  '\&\#x0134;' => '\\^{J}',
  '\&\#x0135;' => '\\^{j}',
  '\&\#x0136;' => 'K',          # 'Ķ' -- \cb{K} from 'combelow' package
  '\&\#x0137;' => 'k',          # 'ķ' -- \cb{k} from 'combelow' package
  '\&\#x0138;' => 'k',          # 'ĸ' -- ???
  '\&\#x0139;' => '\\\'{L}',
  '\&\#x013a;' => '\\\'{l}',
  '\&\#x013b;' => 'L',          # 'Ļ' -- \cb{L} from 'combelow' package
  '\&\#x013c;' => 'l',          # 'ļ' -- \cb{l} from 'combelow' package
  '\&\#x013d;' => 'L\'',        # 'Ľ' -- ???
  '\&\#x013e;' => 'l\'',        # 'ľ' -- ???
  '\&\#x013f;' => 'L',          # 'Ŀ' -- ???
  '\&\#x0140;' => 'l',          # 'ŀ' -- ???
  '\&\#x0141;' => '{\\L}',
  '\&\#x0142;' => '{\\l}',
  '\&\#x0143;' => '\\\'{N}',
  '\&\#x0144;' => '\\\'{n}',
  '\&\#x0145;' => 'N',          # 'Ņ' -- \cb{N} from 'combelow' package
  '\&\#x0146;' => 'n',          # 'ņ' -- \cb{n} from 'combelow' package
  '\&\#x0147;' => '\\v{N}',
  '\&\#x0148;' => '\\v{n}',
  '\&\#x0149;' => 'n',          # 'ŉ' -- ???
  '\&\#x014a;' => '{\\NG}',
  '\&\#x014b;' => '{\\ng}',
  '\&\#x014c;' => '\\={O}',
  '\&\#x014d;' => '\\={o}',
  '\&\#x014e;' => '\\u{O}',
  '\&\#x014f;' => '\\u{o}',
  '\&\#x0150;' => '\\H{A}',
  '\&\#x0151;' => '\\H{a}',
  '\&\#x0152;' => '{\\OE}',
  '\&\#x0153;' => '{\\oe}',
  '\&\#x0154;' => '\\\'{R}',
  '\&\#x0155;' => '\\\'{r}',
  '\&\#x0156;' => 'R',          # 'Ŗ' -- \cb{R} from 'combelow' package
  '\&\#x0157;' => 'r',          # 'ŗ' -- \cb{r} from 'combelow' package
  '\&\#x0158;' => '\\v{R}',
  '\&\#x0159;' => '\\v{r}',
  '\&\#x015a;' => '\\\'{S}',
  '\&\#x015b;' => '\\\'{S}',
  '\&\#x015c;' => '\\^{S}',
  '\&\#x015d;' => '\\^{s}',
  '\&\#x015e;' => '\\c{S}',
  '\&\#x015f;' => '\\c{s}',
  '\&\#x0160;' => '\\v{S}',
  '\&\#x0161;' => '\\v{s}',
  '\&\#x0162;' => 'T',          # 'Ţ' -- \cb{T} from 'combelow' package
  '\&\#x0163;' => 't',          # 'ţ' -- \cb{t} from 'combelow' package
  '\&\#x0164;' => '\\v{T}',
  '\&\#x0165;' => 't\'',        # 'ť' -- ???
  '\&\#x0166;' => 'T',          # 'Ŧ' -- ???
  '\&\#x0167;' => 't',          # 'ŧ' -- ???
  '\&\#x0168;' => '\\~{U}',
  '\&\#x0169;' => '\\~{u}',
  '\&\#x016a;' => '\\={U}',
  '\&\#x016b;' => '\\={u}',
  '\&\#x016c;' => '\\u{U}',
  '\&\#x016d;' => '\\u{u}',
  '\&\#x016e;' => '\\r{U}',
  '\&\#x016f;' => '\\r{u}',
  '\&\#x0170;' => '\\H{U}',
  '\&\#x0171;' => '\\H{u}',
  '\&\#x0172;' => '\\k{U}',
  '\&\#x0173;' => '\\k{u}',
  '\&\#x0174;' => '\\^{W}',
  '\&\#x0175;' => '\\^{w}',
  '\&\#x0176;' => '\\^{Y}',
  '\&\#x0177;' => '\\^{y}',
  '\&\#x0178;' => '\\"{Y}',
  '\&\#x0179;' => '\\\'{Z}',
  '\&\#x017a;' => '\\\'{z}',
  '\&\#x017b;' => '\\.{Z}',
  '\&\#x017c;' => '\\.{z}',
  '\&\#x017d;' => '\\v{Z}',
  '\&\#x017e;' => '\\v{z}',
  '\&\#x017f;' => "f"           # 'ſ' -- ???
}

# Fetch contents of URL as a string.
def fetchURL(url)
  open(url) {|response| response.read}
end

# Convert (some) HTML entities in to TeX.
def convertToTeX(str)
  str.gsub(DEC) do |match|
    if DEC2TEX.has_key? match
      DEC2TEX[match]
    else
      match
    end
  end.gsub(HEX) do |match|
    key = match.downcase
    if HEX2TEX.has_key? key
      HEX2TEX[key]
    else
      match
    end
  end
end

# Fetch and print to stdout BibTeX entries of the authors matching NAME.
def getAuthorBibTeX(name)
  url = "http://portal.acm.org/authorBibTex.cfm?query=(Author:#{name})"
  fetchURL(url).scan(PRE).each do |match|
    bib = convertToTeX match[0].strip
    print bib, "\n\n"
  end
end

ARGV.each do |name|
  retries = 5
  begin
    Timeout::timeout(60) { getAuthorBibTeX name }
  rescue Timeout::Error
    retries -= 1
    if retries > 0
      STDERR.puts "Failed to fetch BibTeX entries for #{name}: request timed out."
      STDERR.puts "Sleeping for 10 seconds..."
      sleep 10 and retry
    else
      abort "Retry limit exhausted, aborting."
    end
  end
end
